; @generated by customCommGenerator
#include <avr/io.h>
	.text
;
; * Receive 1 byte
; * @return high: error low: value
.global	SW_RX_1_receiveByte
	.type	SW_RX_1_receiveByte, @function
SW_RX_1_receiveByte:
	ldi r23, 8
	ldi r25, 0
loop:
	lsr r25
	rcall receiveBit
	cpi r24, 2
	breq err
	or r25, r24
	dec r23
	brne loop

	mov r24, r25
	ldi r25, 0
	ret
	
err:
	ldi 25, 1
	swap r23
	or r25, r23	; High hex digit shows index of failing bit
	ldi 24, 0
	ret
.size	SW_RX_1_receiveByte, .-SW_RX_1_receiveByte
	


;
; * Receive 1 bit
; * @return single byte: 0:0 0b1000000:1 2:error - no start bit detected within timeout
receiveBit:
	; Wait for "start bit" low
	sbis _SFR_IO_ADDR(PINB), 0	; 0
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 1
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 2
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 3
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 4
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 5
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 6
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 7
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 8
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 9
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 10
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 11
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 12
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 13
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 14
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 15
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 16
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 17
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 18
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 19
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 20
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 21
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 22
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 23
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 24
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 25
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 26
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 27
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 28
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 29
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 30
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 31
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 32
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 33
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 34
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 35
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 36
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 37
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 38
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 39
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 40
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 41
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 42
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 43
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 44
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 45
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 46
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 47
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 48
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 49
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 50
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 51
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 52
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 53
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 54
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 55
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 56
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 57
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 58
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 59
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 60
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 61
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 62
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 63
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 64
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 65
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 66
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 67
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 68
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 69
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 70
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 71
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 72
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 73
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 74
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 75
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 76
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 77
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 78
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 79
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 80
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 81
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 82
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 83
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 84
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 85
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 86
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 87
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 88
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 89
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 90
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 91
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 92
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 93
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 94
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 95
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 96
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 97
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 98
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 99
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 100
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 101
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 102
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 103
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 104
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 105
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 106
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 107
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 108
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 109
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 110
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 111
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 112
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 113
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 114
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 115
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 116
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 117
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 118
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 119
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 120
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 121
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 122
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 123
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 124
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 125
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 126
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 127
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 128
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 129
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 130
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 131
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 132
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 133
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 134
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 135
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 136
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 137
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 138
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 139
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 140
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 141
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 142
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 143
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 144
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 145
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 146
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 147
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 148
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 149
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 150
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 151
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 152
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 153
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 154
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 155
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 156
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 157
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 158
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 159
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 160
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 161
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 162
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 163
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 164
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 165
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 166
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 167
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 168
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 169
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 170
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 171
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 172
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 173
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 174
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 175
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 176
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 177
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 178
	rjmp receiveBit_prellWait
	sbis _SFR_IO_ADDR(PINB), 0	; 179
	rjmp receiveBit_prellWait
receiveBit_timeout_start:
	ldi r24, 2
	ret
	
receiveBit_prellWait:
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop

receiveBit_started:
; Debug receiving timing - can be used to inject a edge generating command. Must be defined to empty otherwise
	DEBUG_EDGE_START
	; Wait for end of strobe - high
	sbic _SFR_IO_ADDR(PINB), 0	; 0
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 1
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 2
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 3
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 4
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 5
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 6
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 7
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 8
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 9
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 10
	rjmp receiveBit0
	sbic _SFR_IO_ADDR(PINB), 0	; 11
	rjmp receiveBit0

receiveBit1:
; Debug receiving timing - can be used to inject a edge generating command. Must be defined to empty otherwise
	DEBUG_EDGE_END
	ldi r24, 0b10000000
	ret

receiveBit0:
; Debug receiving timing - can be used to inject a edge generating command. Must be defined to empty otherwise
	DEBUG_EDGE_END
	ldi r24, 0
	ret
	.size	receiveBit, .-receiveBit

